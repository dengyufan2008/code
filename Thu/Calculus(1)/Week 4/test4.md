引理. 对于任意 $n \in \N^*$, 若 $\R$ 上的连续函数 $f$ 的每个函数值恰好取到 $n$ 次, 则对于任意一个 $x_0 \in \R$, 存在一个 $\epsilon>0$ 使得 $\forall x \in (x_0-\epsilon, x_0), f(x)<f(x_0)$ 或 $\forall x \in (x_0-\epsilon, x_0), f(x)>f(x_0)$.

下称 $(x_0-\epsilon, x_0)$ 为 $x_0$ 的左去心邻域, 同理 $(x_0, x_0+\epsilon)$ 为右去心邻域. 二者统称为半去心邻域.

Proof. 反证法. 假设对于任意 $\epsilon>0$, 存在 $x_1, x_2 \in (x_0-\epsilon, x_0)$ 使得 $f(x_1)<f(x_0)$, $f(x_2)>f(x_0)$, 则存在 $x_0-\epsilon<x_3<x_0$ 使得 $f(x_3)=f(x_0)$. 将 $\epsilon$ 置为 $x_0-x_3$ 重新反复做上述过程, 我们可以得到 $f(x_0)$ 出现无穷次. 矛盾. $\blacksquare$

推论. 将引理的左去心邻域改为右去心邻域, 引理依旧成立.

---

Lemma 1. 对于任意 $n \in \N^*$, 不存在 $\R$ 上的连续函数 $f$, 使得 $f$ 的每个函数值恰好取到 $2n$ 次.

Proof. 反证法. 设 $f(0)$ 的所有出现位置为 $x_1, x_2, \cdots, x_{2n}$. 则对于 $x_i$ 都各存在一个左去心邻域和右去心邻域, 共 $4n$ 个半去心邻域, 使得每个半去心邻域中要么所有的函数值大于 $f(0)$, 要么所有的函数值小于 $f(0)$. 下文简记一个去心邻域所有函数值大于 $f(0)$ 为大去心邻域, 否则为小去心邻域.

不难看出应当恰有 $2n$ 个半去心邻域是大的, 而 $2n$ 个半去心邻域是小的 (否则存在一个和 $f(0)$ 足够接近的数出现超过 $2n$ 次), 且 $x_i$ 的右去心邻域要和 $x_{i+1}$ 的左去心邻域同大或同小 (否则 $x_i$ 和 $x_{i+1}$ 中间会多一个位置函数值为 $f(0)$). 故可以把 $x_i$ 的右去心邻域与 $x_{i+1}$ 的左去心邻域看作一组, 共有 $2n-1$ 组半去心邻域和两端的两个未分组的半去心邻域.

进一步, 不难看出恰有 $n$ 组半去心邻域是大的, 而 $n-1$ 组半去心邻域是小的 (或 $n$ 组小 $n-1$ 组大, 但不妨这么假设) (否则至少 $n+1$ 组半去心邻域同大或同小, 矛盾). 故两端两个半去心邻域都是小的.

考虑 $[x_1, x_{2n}]$ 内 $f(x)$ 的最大值 (显然存在) $w$. 若 $w$ 在 $[x_1, x_{2n}]$ 内出现了 $2n$ 次, 则每个出现位置的左右去心邻域都满足所有函数值都小于 $w$, 存在一个与 $w$ 足够接近的数出现 $4n>2n$ 次. 故 $w$ 在 $[x_1, x_{2n}]$ 外会出现至少一次.

由于两端的两个半去心邻域是小的, 显然 $w$ 不在两端的两个半去心邻域内. 则无论 $w$ 出现在 $x_1$ 的左去心邻域左侧还是 $x_{2n}$ 的右去心邻域右侧, 都有一个额外的 $f(0)$ 的出现位置. 故矛盾. $\blacksquare$

---

Lemma 2. 对于任意 $n \in \N$, 存在 $\R$ 上的连续函数 $f$, 使得 $f$ 的每个函数值恰好取到 $2n+1$ 次.

Proof. 设 $m=2n+1$, 考虑函数

$$f(x)=\left\{
\begin{aligned}
& \lfloor \frac{x}{m} \rfloor + x - \lfloor x \rfloor & (\lfloor x \rfloor \bmod m \bmod 2=0)
\\
& \lfloor \frac{x}{m} \rfloor - x + \lfloor x \rfloor + 1 & (\lfloor x \rfloor \bmod m \bmod 2=1)
\end{aligned}
\right..$$

先证明连续性. 显然对于每个 $[n, n+1)$, $f(x)$ 是初等函数. 若 $[n, n+1)$ 位于第一种情况, 则 $\lim_{x \rightarrow n+1} f(x)=\lfloor \frac{n}{m} \rfloor + 1$. 若 $n+1$ 不是 $m$ 的倍数, 则 $[n+1, n+2)$ 位于第二种情况, 有 $f(n+1)=\lfloor \frac{n}{m} \rfloor + 1$; 否则 $n+1$ 是 $m$ 的倍数, 则 $[n+1, n+2)$ 位于第一种情况, 也有 $f(n+1)=\lfloor \frac{n}{m} \rfloor + 1$. 若 $[n, n+1)$ 位于第二种情况, 则 $\lim_{x \rightarrow n+1} f(x)=\lfloor \frac{n}{m} \rfloor$, $[n+1, n+2)$ 位于第一种情况, 有 $f(n+1)=\lfloor \frac{n}{m} \rfloor$.

再证明每个 $y$ 都被取到 $m$ 次. 若 $y$ 为整数, 则考虑 $my-m+1, my-m+3, \cdots, my, my+2, \cdots, my+m-1$. 容易验证 $my-m+2k \space (1 \le k \le n)$ 和 $my+2k-1 \space (1 \le k < n)$ 的取值不为 $y$, 其他整数可用段内的取值范围验证. 若 $y$ 不为整数, 则设 $t=\lfloor y \rfloor$, 考虑 $[tm+k, tm+k+1) \space (0 \le k < m)$ 内每一段都是取值范围包括了 $y$ 的双射, 其他段显然取值范围不包括 $y$. $\blacksquare$
