# 左右横跳

$[0, n-1]$ 内每个整点有一个人, 给定一个 L 或 R 组成的指令串 $S$, 每个字符表示所有人往负方向 或 正方向 走一单位. 如果走到了 $-1$ 则回到 $0$, 走到了 $n$ 则死亡, 死亡后无法移动. 问执行 $S^\infty$ 后有多少人能活着.

$1 \le n \le 10^9$, $0 \le |S| \le 10^6$.

---

设 L 为 $-1$, R 为 $1$.

考虑什么时候会全死光. 容易发现 $S^\infty$ 中不能有连续的一段使得和为 $n$, 否则之前在 $0$ 的人死不了. 故为充要条件. 考虑判定.

- 跨过至少 $3$ 个 $S$.
  
  此时有 $sum > 0$, 否则不优. 容易发现此为充要条件.

- 跨过 $2$ 个 $S$.

  此时 $premax + sufmax \ge n$.

- 在 $S$ 内部.

  此时 $S$ 存在一个前缀使得 $sufmax \ge n$.

其中 $sum$ 为整串的和, $premax$ 为 $S$ 的一个前缀使得其 $sum$ 最大, $sufmax$ 同理.

考虑如何动态维护 $sufmax$. 有 $sufmax \leftarrow \max(sufmax + w_i, 0)$, 其中 $w_i \in \{-1, 1\}$. 容易发现 $sufmax$ 也即之前在 $0$ 的人此时的位置, 但不重要.

现在至少有一个人不会死. 考虑计算活着的个数.

因为之前在 $0$ 的人不会死, 则到过 $0$ 的人都不会死. 故现在可以去除走到 $-1$ 则回到 $0$ 的限制, 因为反正不会死多往左走几步也无所谓, 则现在所有人始终为一个长为 $n$ 的区间.

去除走到 $n$ 就不能动的限制, 考虑区间到达过的最靠右的位置, 该时刻与 $[0,n-1]$ 的交的长度即为答案. 发现如果走满了 $S$ 则不优, 因为 $sum \le 0$, 故会取 $premax$. 故答案为 $n - premax$.

时间复杂度 $O(|S|)$.
